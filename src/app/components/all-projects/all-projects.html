<div class="page-layout-content">

  <header class="header-row">
    <h1 class="page-title">My all projects</h1>
     <div class="actions-container" style="display: flex; gap: 16px;">
      <button color="accent" class="animated-fab" (click)="toggleCreate()">
        <span class="plus-sign">+</span>
        <span class="fab-text">Add task</span>
      </button>
    </div>
  </header>

  <div class="controls-row">
    <mat-form-field appearance="outline" class="modern-search-field">
      <mat-icon matPrefix style="color: var(--app-primary); margin-left: 8px;">search</mat-icon>
      <input matInput [formControl]="searchControl" (input)="onSearch($event)" placeholder=" Search project...">
    </mat-form-field>
  </div>

  @if (projectsService.isLoading()) {
  <div class="loading-state">
    <mat-spinner diameter="50"></mat-spinner>
  </div>
  }

  @else {
  <main class="content-grid">

    @for (project of filteredProjects(); track project.id) {

    <mat-card class="project-card" [routerLink]="['/projects', project.id, 'tasks']">

      <mat-card-header>
        <mat-card-title>{{ project.name }}</mat-card-title>
      </mat-card-header>

      <mat-card-content style="margin-top: 16px; flex: 1; display: flex; flex-direction: column;">
        <p class="project-desc">
          {{ project.description || 'There is no description to the project' }}
        </p>

        <div style="flex: 1;"></div>

        <button mat-raised-button class="action-btn">
           Enter to tasks
        </button>
      </mat-card-content>

    </mat-card>

    } @empty {
    <div class="empty-state">
      <mat-icon style="font-size: 64px; height: 64px; width: 64px; opacity: 0.5; color: #90a4ae;">search_off</mat-icon>
      <h3>No matching projects found.</h3>
    </div>
    }

  </main>
  }
  @if (isCreateOpen()) {
  <div class="modal-overlay" (click)="toggleCreate()">
    <form [formGroup]="projectForm" class="modal-box" (ngSubmit)="createProject()" (click)="$event.stopPropagation()">
      <h2>New project</h2>
      <div style="display: flex; flex-direction: column; gap: 16px;">
        <input type="text" formControlName="name" placeholder="שם הפרויקט" class="styled-input" autofocus>
        <textarea formControlName="description" placeholder="תיאור" rows="4" class="styled-input"></textarea>
        <div style="display: flex; gap: 16px;">
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>To select a team</mat-label>
            <mat-select formControlName="team_id">
              @for(team of allTeams();track team.id){
              <mat-option value="{{team.id}}" style="font-weight: bold;">{{team.name}}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
        <div class="modal-actions">
          <button type="button" mat-button (click)="toggleCreate()">Delete</button>
          <button type="submit" mat-raised-button color="primary" [disabled]="projectForm.invalid">Create a project</button>
        </div>
      </div>  
    </form>
  </div>
  }
</div>